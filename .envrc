#!/bin/bash
# Direnv configuration for DBDoc

# Create and activate virtual environment using uv
if [[ ! -d ".venv" ]]; then
    echo "Creating virtual environment with uv..."
    uv venv
fi

# Activate the virtual environment
source .venv/bin/activate

# Install dependencies if they're not installed
if [[ ! -f ".venv/pyvenv.cfg" ]] || ! python -c "import fastapi" 2>/dev/null; then
    echo "Installing dependencies..."
    uv pip install -e ".[dev]"
    uv pip install faker  # For test data generation
fi

# Set environment variables
export PYTHONPATH="${PWD}:${PYTHONPATH}"
export OPENAI_API_KEY="${OPENAI_API_KEY:-}"
export ANTHROPIC_API_KEY="${ANTHROPIC_API_KEY:-}"
export DATABASE_URL="${DATABASE_URL:-sqlite:///./dbdoc.db}"

echo "ðŸš€ DBDoc development environment activated"
echo "ðŸ’¡ Run 'python -m dbdoc.main' to start the server"